<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Guitar Tuner - String by String (Mic Enabled)</title>
    <meta name="description" content="Easiest online guitar tuner. Select string (E A D G B E) and tune using your microphone. Visual needle and clear instructions for beginners.">
    <link rel="icon" href="https://xizoa.com/favicon.ico">

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- THEME --- */
        :root {
            --bg: #121212; --card: #1e1e1e;
            --gold: #ffb703; --green: #2ecc71; --red: #e74c3c;
            --text: #ffffff;
        }
        * { box-sizing:border-box; margin:0; padding:0; font-family: 'Outfit', sans-serif; }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; }

        /* Header */
        header { width: 100%; padding: 15px 20px; background: #000; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 1.4rem; font-weight: 800; color: #fff; text-decoration: none; }
        .brand span { color: var(--gold); }

        /* MAIN TUNER BOX */
        .tuner-container {
            max-width: 500px; width: 95%; margin: 30px auto;
            background: var(--card); border-radius: 20px; padding: 30px 20px;
            text-align: center; border: 1px solid #333;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* NEEDLE METER */
        .meter-area {
            width: 280px; height: 140px; margin: 0 auto 20px; position: relative; overflow: hidden;
        }
        .meter-bg {
            width: 280px; height: 140px; background: radial-gradient(circle at 50% 100%, #333 0%, transparent 70%);
            border-top-left-radius: 140px; border-top-right-radius: 140px;
            border: 4px solid #444; border-bottom: none;
        }
        .needle {
            width: 4px; height: 130px; background: var(--red);
            position: absolute; bottom: 0; left: 50%; transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg); transition: 0.1s ease-out;
            border-radius: 5px; z-index: 10;
        }
        .center-dot {
            width: 15px; height: 15px; background: #fff; border-radius: 50%;
            position: absolute; bottom: -7px; left: 50%; transform: translateX(-50%); z-index: 11;
        }

        /* NOTE DISPLAY */
        .target-note { font-family: 'Orbitron', sans-serif; font-size: 4rem; color: #555; margin-bottom: 5px; }
        .target-note.active { color: var(--gold); text-shadow: 0 0 20px var(--gold); }
        .target-note.tuned { color: var(--green); text-shadow: 0 0 20px var(--green); }

        .instruction { font-size: 1.1rem; font-weight: 600; color: #888; min-height: 25px; margin-bottom: 20px; }

        /* START BUTTON */
        .btn-start {
            background: var(--gold); color: #000; font-weight: 800; border: none;
            padding: 12px 30px; border-radius: 50px; cursor: pointer; font-size: 1rem;
            margin-bottom: 30px;
        }
        .btn-start.active { background: var(--red); color: #fff; animation: pulse 2s infinite; }

        /* STRING SELECTOR BUTTONS (APP STYLE) */
        .headstock-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;
            background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333;
        }
        .string-col { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        
        .str-btn {
            width: 60px; height: 60px; border-radius: 50%; background: #2a2a2a;
            border: 2px solid #444; color: #fff; font-weight: 700; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.2s; position: relative;
        }
        .str-btn small { font-size: 0.7rem; color: #aaa; font-weight: 400; }
        .str-btn:hover { border-color: var(--gold); }
        
        /* Selected State */
        .str-btn.selected { background: var(--gold); color: #000; border-color: #fff; box-shadow: 0 0 15px var(--gold); transform: scale(1.1); }
        .str-btn.selected small { color: #000; }

        /* CONTENT SECTION */
        .guide-section { max-width: 600px; margin: 40px auto; padding: 20px; }
        .guide-card { background: #181818; padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--gold); }
        .guide-card h3 { color: #fff; margin-bottom: 10px; font-size: 1.2rem; }
        .guide-card p, .guide-card li { color: #bbb; font-size: 0.95rem; margin-bottom: 8px; line-height: 1.6; }
        .guide-card ul { margin-left: 20px; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="brand"><i class="fas fa-guitar"></i> XIZOA <span>TUNER</span></a>
    </header>

    <div class="tuner-container">
        
        <div class="meter-area">
            <div class="meter-bg"></div>
            <div class="needle" id="needle"></div>
            <div class="center-dot"></div>
        </div>

        <div class="target-note" id="noteName">--</div>
        <div class="instruction" id="instruction">Click 'Start Tuner' first</div>

        <button class="btn-start" id="micBtn" onclick="toggleMic()">
            <i class="fas fa-microphone"></i> START TUNER
        </button>

        <p style="color:#666; font-size:0.8rem; margin-bottom:10px;">SELECT STRING TO TUNE</p>
        <div class="headstock-grid">
            <div class="string-col">
                <div class="str-btn" onclick="selectString(0, this)">D <small>4th</small></div>
                <div class="str-btn" onclick="selectString(1, this)">A <small>5th</small></div>
                <div class="str-btn" onclick="selectString(2, this)">E <small>6th</small></div>
            </div>
            <div class="string-col">
                <div class="str-btn" onclick="selectString(3, this)">G <small>3rd</small></div>
                <div class="str-btn" onclick="selectString(4, this)">B <small>2nd</small></div>
                <div class="str-btn" onclick="selectString(5, this)">E <small>1st</small></div>
            </div>
        </div>

    </div>

    <div class="guide-section">
        
        <div class="guide-card">
            <h3>ðŸŽ¸ Guitar Tune Kaise Karein? (How to Use)</h3>
            <ol>
                <li>Upar yellow button <strong>"START TUNER"</strong> par click karein aur Mic ki permission dein.</li>
                <li>Niche diye gaye buttons me se <strong>String Select Karein</strong> (Jaise "6th E" - Mota taar).</li>
                <li>Apni guitar ka wo taar bajayein.</li>
                <li><strong>Suui (Needle) Dekhein:</strong>
                    <ul>
                        <li>Agar Suui <strong>Left</strong> hai: Taar bohot dheela hai. Use <strong>Tight (Kaso)</strong> karein.</li>
                        <li>Agar Suui <strong>Right</strong> hai: Taar bohot tight hai. Use <strong>Loose (Dheela)</strong> karein.</li>
                        <li>Agar Suui <strong>Beech me (Green)</strong> ho jaye: Matlab Tune ho gaya! âœ…</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="guide-card" style="border-color: #00f3ff;">
            <h3>String Numbers Guide</h3>
            <ul>
                <li><strong>6th String (E):</strong> Sabse Mota taar (Sabse upar wala).</li>
                <li><strong>5th String (A):</strong> Uske niche wala.</li>
                <li><strong>1st String (E):</strong> Sabse Patla taar (Sabse niche wala).</li>
            </ul>
        </div>

    </div>

    <script>
        // Standard Frequencies
        const strings = [
            { note: "D", freq: 146.83, index: 4 }, // 4th
            { note: "A", freq: 110.00, index: 5 }, // 5th
            { note: "E", freq: 82.41,  index: 6 }, // 6th (Low)
            { note: "G", freq: 196.00, index: 3 }, // 3rd
            { note: "B", freq: 246.94, index: 2 }, // 2nd
            { note: "E", freq: 329.63, index: 1 }  // 1st (High)
        ];

        let audioCtx, analyser, source, animationId;
        let isRunning = false;
        let currentTarget = null; // Target frequency

        // --- 1. START MIC ---
        async function toggleMic() {
            if(isRunning) {
                location.reload(); // Simple stop
            } else {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    analyser = audioCtx.createAnalyser();
                    analyser.fftSize = 2048;
                    
                    source = audioCtx.createMediaStreamSource(stream);
                    source.connect(analyser);
                    
                    isRunning = true;
                    document.getElementById('micBtn').innerHTML = "STOP TUNER";
                    document.getElementById('micBtn').classList.add('active');
                    document.getElementById('instruction').innerText = "Select a String button below ðŸ‘‡";
                    
                    updatePitch();
                } catch(e) {
                    alert("Mic Error: Please allow microphone permission.");
                }
            }
        }

        // --- 2. SELECT STRING ---
        function selectString(index, btn) {
            if(!isRunning) {
                alert("Please click START TUNER first!");
                return;
            }
            
            // UI Update
            document.querySelectorAll('.str-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Set Target
            currentTarget = strings[index];
            document.getElementById('noteName').innerText = currentTarget.note;
            document.getElementById('noteName').className = "target-note active";
            document.getElementById('instruction').innerText = `Pluck String ${currentTarget.index} (${currentTarget.note})`;
        }

        // --- 3. PITCH DETECTION LOOP ---
        function updatePitch() {
            if(!isRunning) return;

            const buffer = new Float32Array(analyser.fftSize);
            analyser.getFloatTimeDomainData(buffer);
            
            const freq = autoCorrelate(buffer, audioCtx.sampleRate);
            
            if(freq !== -1 && currentTarget) {
                // Calculate difference in Cents
                // Formula: 1200 * log2(Measured / Target)
                const cents = 1200 * Math.log2(freq / currentTarget.freq);
                
                // Needle Logic (-50 to +50 cents range visually)
                let deg = cents;
                if(deg > 45) deg = 45; 
                if(deg < -45) deg = -45;
                
                const needle = document.getElementById('needle');
                needle.style.transform = `translateX(-50%) rotate(${deg}deg)`;

                // Feedback Logic
                const status = document.getElementById('instruction');
                const noteUI = document.getElementById('noteName');

                if(Math.abs(cents) < 5) {
                    // Tuned
                    needle.style.backgroundColor = "#2ecc71"; // Green
                    status.innerText = "PERFECT! âœ…";
                    status.style.color = "#2ecc71";
                    noteUI.classList.add('tuned');
                } else if(cents < 0) {
                    // Too Low
                    needle.style.backgroundColor = "#e74c3c"; // Red
                    status.innerText = "Too Loose -> Tighten It (Kaso) ðŸ”¼";
                    status.style.color = "#e74c3c";
                    noteUI.classList.remove('tuned');
                } else {
                    // Too High
                    needle.style.backgroundColor = "#e74c3c";
                    status.innerText = "Too Tight -> Loosen It (Dhila karo) ðŸ”½";
                    status.style.color = "#e74c3c";
                    noteUI.classList.remove('tuned');
                }
            }

            requestAnimationFrame(updatePitch);
        }

        // --- AUTO CORRELATION (MATH) ---
        function autoCorrelate(buf, sampleRate) {
            let SIZE = buf.length;
            let rms = 0;
            for (let i=0;i<SIZE;i++) { let val = buf[i]; rms += val*val; }
            rms = Math.sqrt(rms/SIZE);
            if (rms<0.01) return -1; // Silence

            let r1=0, r2=SIZE-1, thres=0.2;
            for (let i=0; i<SIZE/2; i++) if (Math.abs(buf[i])<thres) { r1=i; break; }
            for (let i=1; i<SIZE/2; i++) if (Math.abs(buf[SIZE-i])<thres) { r2=SIZE-i; break; }
            buf = buf.slice(r1,r2);
            SIZE = buf.length;

            let c = new Array(SIZE).fill(0);
            for (let i=0; i<SIZE; i++)
                for (let j=0; j<SIZE-i; j++) c[i] = c[i] + buf[j]*buf[j+i];

            let d=0; while (c[d]>c[d+1]) d++;
            let maxval=-1, maxpos=-1;
            for (let i=d; i<SIZE; i++) if (c[i] > maxval) { maxval = c[i]; maxpos = i; }
            let T0 = maxpos;

            let x1=c[T0-1], x2=c[T0], x3=c[T0+1];
            let a = (x1 + x3 - 2*x2)/2;
            let b = (x3 - x1)/2;
            if (a) T0 = T0 - b/(2*a);

            return sampleRate/T0;
        }
    </script>
</body>
</html>
